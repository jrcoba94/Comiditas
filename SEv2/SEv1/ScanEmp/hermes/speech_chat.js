function startButton(a){return recognizing?void recognition.stop():(final_transcript="",recognition.lang="es-MX",recognition.start(),ignore_onend=!1,$("#message").val(""),$("#start_img").attr("src","http://soldai.com/mic-slash.gif"),void(start_timestamp=a.timeStamp))}function capitalize(a){return a.replace(first_char,function(a){return a.toUpperCase()})}function linebreak(a){return a.replace(two_line,"<p></p>").replace(one_line,"<br>")}function notSupported(){$("#start_button").css("display","none"),$("#message").css("width","95%")}var final_transcript="",recognizing=!1,ignore_onend,start_timestamp,activeMic=!1,recognition;if("webkitSpeechRecognition"in window){$("#start_button").css("display","inline-block"),$("#message").css("width","85%");var recognition=new webkitSpeechRecognition;recognition.continuous=!0,recognition.onstart=function(){recognizing=!0,$("#message").css("color","#999"),$("#message").val("Escuchando..."),$("#start_img").attr("src","http://soldai.com/mic-animate.gif")},recognition.onerror=function(a){$("#start_img").attr("src","http://soldai.com/mic.gif"),$("#message").css("color","#000"),"no-speech"==a.error&&($("#messageText").append('<div class="messages hermes">No pude escuchar lo que dijiste.</div>'),ignore_onend=!0),"audio-capture"==a.error&&($("#messageText").append('<div class="messages hermes">Parece que no tienes micrófono o que no está configurado correctamente.</div>'),ignore_onend=!0),"not-allowed"==a.error&&(a.timeStamp-start_timestamp<100?$("#messageText").append('<div class="messages hermes">Micrófono bloqueado. Por favor cambia la configuración.</div>'):$("#messageText").append('<div class="messages hermes">No se permitió el acceso al micrófono.</div>'),ignore_onend=!0),updateScroll("messageText")},recognition.onend=function(){if(recognizing=!1,ignore_onend)return void $("#message").val("");if($("#start_img").attr("src","http://soldai.com/mic.gif"),$("#message").css("color","#000"),!final_transcript)return void $("#message").val("");if(window.getSelection){window.getSelection().removeAllRanges();var a=document.createRange();a.selectNode(document.getElementById("message")),window.getSelection().addRange(a)}},recognition.onresult=function(a){$("#message").css("color","#DDD"),$("#message").val("Espera un momento...");for(var b="",c=a.resultIndex;c<a.results.length;++c)a.results[c].isFinal?final_transcript+=a.results[c][0].transcript:b+=a.results[c][0].transcript;final_transcript=capitalize(final_transcript),$("#message").css("color","#000"),$("#message").val(linebreak(final_transcript)),startButton(),setTimeout(function(){$("#message").trigger("enterKey")},800)}}else notSupported();var first_char=/\S/,two_line=/\n\n/g,one_line=/\n/g;